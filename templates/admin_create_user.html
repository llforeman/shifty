{% extends "base.html" %}

{% block title %}Crear Usuario - Shifty{% endblock %}

{% block content %}
<h1>Crear Nuevo Usuario</h1>

<div
    style="background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); max-width: 600px;">
    <form method="POST">

        <div style="margin-bottom: 20px;">
            <label for="name" style="display: block; margin-bottom: 5px; font-weight: bold;">Nombre Completo
                (Pediatra):</label>
            <input type="text" id="name" name="name" required placeholder="Dr. Ejemplo"
                style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
            <small style="color: #666; display: block; margin-top: 5px;">
                Se creará un nuevo Pediatra con este nombre si no existe, o se vinculará si ya existe.
            </small>
        </div>

        <div style="margin-bottom: 20px;">
            <label for="username_code" style="display: block; margin-bottom: 5px; font-weight: bold;">Usuario /
                Código:</label>
            <input type="text" id="username_code" name="username_code" required placeholder="vic1name.surname"
                style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
            <small style="color: #666; display: block; margin-top: 5px;">
                Este será el código para iniciar sesión (ej: vic1name.surname).
            </small>
        </div>

        <div style="margin-bottom: 20px;">
            <label style="display: block; margin-bottom: 5px; font-weight: bold;">Rol:</label>
            <select name="role" id="role_select"
                style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
                <option value="user" selected>Usuario (Pediatra/Staff)</option>
                <option value="manager">Administrador (Manager)</option>
            </select>
        </div>

        <div id="staff_fields">
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 5px; font-weight: bold;">Tipo de Personal:</label>
                <select name="staff_type"
                    style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
                    <option value="adjunto">Adjunto</option>
                    <option value="residente">Residente</option>
                </select>
            </div>

            <div style="margin-bottom: 20px;">
                <label style="font-weight: bold;">
                    <input type="checkbox" name="is_mir" value="yes"> Es MIR
                </label>
            </div>
        </div>

        <script>
            document.getElementById('role_select').addEventListener('change', function () {
                var staffFields = document.getElementById('staff_fields');
                if (this.value === 'manager') {
                    staffFields.style.display = 'none';
                } else {
                    staffFields.style.display = 'block';
                }
            });
        </script>

        <div class="alert alert-warning"
            style="background-color: #fff3cd; color: #856404; padding: 10px; border-radius: 4px; margin-bottom: 20px;">
            <strong>Nota:</strong> La contraseña inicial será <code>1111</code>. El usuario deberá cambiarla al iniciar
            sesión.
        </div>

        <div style="display: flex; gap: 10px;">
            <a href="{{ url_for('manager_config') }}"
                style="padding: 10px 20px; background: #ccc; color: #333; text-decoration: none; border-radius: 4px;">Cancelar</a>
            <button type="submit"
                style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">Crear
                Usuario</button>
        </div>

    </form>
</div>

<div style="margin-top: 40px;">
    <h2>Usuarios Existentes</h2>
    <table
        style="width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
        <thead style="background: #f8f9fa;">
            <tr>
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">ID</th>
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Usuario / Email</th>
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Rol</th>
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Pediatra Vinculado</th>
                <th style="padding: 12px; text-align: left; border-bottom: 2px solid #ddd;">Detalles</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr style="border-bottom: 1px solid #eee;">
                <td style="padding: 10px;">{{ user.id }}</td>
                <td style="padding: 10px;">{{ user.username }}</td>
                <td style="padding: 10px;">
                    {% if user.role == 'manager' %}
                    <span
                        style="background: #3498db; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.9em;">Admin</span>
                    {% else %}
                    <span
                        style="background: #2ecc71; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.9em;">Usuario</span>
                    {% endif %}
                </td>
                <td style="padding: 10px;">
                    {% if user.pediatrician %}
                    {{ user.pediatrician.name }}
                    {% else %}
                    <span style="color: #999;">-</span>
                    {% endif %}
                </td>
                <td style="padding: 10px;">
                    {% if user.pediatrician %}
                    <span class="badge" style="background: #eee; padding: 2px 5px; border-radius: 4px;">{{
                        user.pediatrician.type or '?' }}</span>
                    {% if user.pediatrician.mir %}
                    <span class="badge" style="background: #ffeaa7; padding: 2px 5px; border-radius: 4px;">MIR</span>
                    {% endif %}
                    {% else %}
                    -
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}