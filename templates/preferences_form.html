{% extends "base.html" %}

{% block title %}{{ pediatrician.name }} - Preferencias{% endblock %}

{% block extra_styles %}
<style>
    form label {
        display: inline-block;
        margin-top: 10px;
        font-weight: bold;
    }

    form input,
    form select {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
    }

    form button {
        margin-top: 15px;
        padding: 10px 20px;
        background-color: #3498db;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    form button:hover {
        background-color: #2980b9;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    table th,
    table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
    }

    table th {
        background-color: #f2f2f2;
        font-weight: bold;
    }

    .delete-btn {
        background-color: #e74c3c;
        color: white;
        padding: 5px 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    .delete-btn:hover {
        background-color: #c0392b;
    }

    .mode-selector {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
    }

    .mode-option {
        padding: 10px 20px;
        border: 2px solid #ddd;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .mode-option:hover {
        border-color: #3498db;
        background-color: #f0f8ff;
    }

    .mode-option.active {
        border-color: #3498db;
        background-color: #3498db;
        color: white;
    }

    .form-section {
        display: none;
    }

    .form-section.active {
        display: block;
    }

    .date-range {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }

    .recurring-badge {
        display: inline-block;
        background: #3498db;
        color: white;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 12px;
        margin-left: 8px;
    }
</style>
{% endblock %}

{% block content %}
<h1>{{ pediatrician.name}} - Preferencias de Guardias</h1>

<div style="background: #e8f4f8; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
    <h2 style="margin-top: 0;">AÃ±adir Preferencia</h2>

    <!-- Mode Selector -->
    <div class="mode-selector">
        <div class="mode-option active" onclick="selectMode('specific')">
            ðŸ“… Fecha EspecÃ­fica
        </div>
        <div class="mode-option" onclick="selectMode('recurring')">
            ðŸ”„ DÃ­a de la Semana (Recurrente)
        </div>
    </div>

    <form method="POST" id="preference-form">
        <input type="hidden" name="preference_mode" id="preference_mode" value="specific">

        <!-- Specific Date Section -->
        <div id="specific-section" class="form-section active">
            <label for="req_date">Fecha:</label>
            <input type="date" id="req_date" name="request_date">
        </div>

        <!-- Recurring Weekday Section -->
        <div id="recurring-section" class="form-section">
            <label for="weekday">DÃ­a de la Semana:</label>
            <select id="weekday" name="weekday">
                <option value="">Seleccionar dÃ­a...</option>
                <option value="monday">Lunes</option>
                <option value="tuesday">Martes</option>
                <option value="wednesday">MiÃ©rcoles</option>
                <option value="thursday">Jueves</option>
                <option value="friday">Viernes</option>
                <option value="saturday">SÃ¡bado</option>
                <option value="sunday">Domingo</option>
            </select>

            <div class="date-range">
                <div>
                    <label for="start_month">Desde (Mes/AÃ±o):</label>
                    <div style="display: flex; gap: 10px;">
                        <select id="start_month" name="start_month" style="flex: 1;">
                            <option value="1">Enero</option>
                            <option value="2">Febrero</option>
                            <option value="3">Marzo</option>
                            <option value="4">Abril</option>
                            <option value="5">Mayo</option>
                            <option value="6">Junio</option>
                            <option value="7">Julio</option>
                            <option value="8">Agosto</option>
                            <option value="9">Septiembre</option>
                            <option value="10">Octubre</option>
                            <option value="11">Noviembre</option>
                            <option value="12">Diciembre</option>
                        </select>
                        <input type="number" id="start_year" name="start_year" placeholder="AÃ±o" min="2025" max="2030"
                            value="2026" style="flex: 1;">
                    </div>
                </div>

                <div>
                    <label for="end_month">Hasta (Mes/AÃ±o):</label>
                    <div style="display: flex; gap: 10px;">
                        <select id="end_month" name="end_month" style="flex: 1;">
                            <option value="1">Enero</option>
                            <option value="2">Febrero</option>
                            <option value="3">Marzo</option>
                            <option value="4">Abril</option>
                            <option value="5">Mayo</option>
                            <option value="6">Junio</option>
                            <option value="7">Julio</option>
                            <option value="8">Agosto</option>
                            <option value="9">Septiembre</option>
                            <option value="10">Octubre</option>
                            <option value="11">Noviembre</option>
                            <option value="12">Diciembre</option>
                        </select>
                        <input type="number" id="end_year" name="end_year" placeholder="AÃ±o" min="2025" max="2030"
                            value="2026" style="flex: 1;">
                    </div>
                </div>
            </div>
        </div>

        <label for="req_type">Tipo de Preferencia:</label>
        <select id="req_type" name="request_type" required>
            <option value="Vacation">Vacation (Vacaciones)</option>
            <option value="Skip">Skip (No disponible)</option>
            <option value="Prefer">Prefer (Prefiero trabajar)</option>
            <option value="Prefer Not">Prefer Not (Prefiero no trabajar)</option>
        </select>

        <button type="submit">Guardar Preferencia</button>
    </form>
</div>

<!-- Display Recurring Preferences -->
{% if recurring_prefs %}
<h2>Preferencias Recurrentes (DÃ­a de la Semana)</h2>
<table>
    <thead>
        <tr>
            <th>DÃ­a de la Semana</th>
            <th>Tipo</th>
            <th>Rango</th>
            <th>Cantidad</th>
            <th>AcciÃ³n</th>
        </tr>
    </thead>
    <tbody>
        {% for pref in recurring_prefs %}
        <tr>
            <td><strong>{{ pref.weekday }}</strong></td>
            <td>{{ pref.type }}</td>
            <td>{{ pref.start_date.strftime('%b %Y') }} - {{ pref.end_date.strftime('%b %Y') }}</td>
            <td><span class="recurring-badge">{{ pref.count }} dÃ­as</span></td>
            <td>
                <form method="POST" style="display: inline;">
                    <input type="hidden" name="delete_recurring_group" value="{{ pref.group_id }}">
                    <button type="submit" class="delete-btn"
                        onclick="return confirm('Â¿Eliminar todas las {{ pref.count }} preferencias de {{ pref.weekday }}?')">Eliminar</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endif %}

<!-- Display Individual Preferences -->
<h2>Preferencias Individuales</h2>
{% if individual_prefs %}
<table>
    <thead>
        <tr>
            <th>Fecha</th>
            <th>Tipo</th>
            <th>AcciÃ³n</th>
        </tr>
    </thead>
    <tbody>
        {% for pref in individual_prefs %}
        <tr>
            <td>{{ pref.date.strftime('%Y-%m-%d') }}</td>
            <td>{{ pref.type }}</td>
            <td>
                <form method="POST" style="display: inline;">
                    <input type="hidden" name="preference_mode" value="specific">
                    <input type="hidden" name="request_date" value="{{ pref.date.strftime('%Y-%m-%d') }}">
                    <input type="hidden" name="request_type" value="Delete">
                    <button type="submit" class="delete-btn">Eliminar</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<p style="color: #999; font-style: italic;">No hay preferencias individuales guardadas.</p>
{% endif %}

<script>
    function selectMode(mode) {
        // Update UI
        document.querySelectorAll('.mode-option').forEach(el => el.classList.remove('active'));
        event.target.classList.add('active');

        // Update hidden field
        document.getElementById('preference_mode').value = mode;

        // Show/hide sections
        document.querySelectorAll('.form-section').forEach(el => el.classList.remove('active'));
        document.getElementById(mode + '-section').classList.add('active');

        // Update required fields
        if (mode === 'specific') {
            document.getElementById('req_date').required = true;
            document.getElementById('weekday').required = false;
        } else {
            document.getElementById('req_date').required = false;
            document.getElementById('weekday').required = true;
        }
    }
</script>

{% endblock %}