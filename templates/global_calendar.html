{% extends "base.html" %}

{% block title %}Calendario Global - Shifty{% endblock %}

{% block extra_styles %}
<style>
    .calendar-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    /* ACTIVITY VERTICAL VIEW */
    .activity-view-table {
        width: 100%;
        border-collapse: collapse;
        background: white;
    }

    .activity-view-table th,
    .activity-view-table td {
        border: 1px solid #ddd;
        padding: 8px;
        vertical-align: top;
    }

    .activity-view-table th {
        background: #f8f9fa;
        text-align: center;
    }

    .activity-row-header {
        background: #f1f3f5;
        font-weight: bold;
        width: 150px;
    }

    .activity-cell {
        position: relative;
        padding: 0 !important;
        background-color: #fff;
        /* Grid lines: 24h = 100%. 1 hour ~ 4.16% */
        background-image: linear-gradient(to right, #f1f3f5 1px, transparent 1px);
        background-size: 4.166% 100%;
        min-height: 50px;
    }

    .timeline-event {
        position: absolute;
        height: 20px;
        line-height: 20px;
        /* Center text vertically */
        font-size: 11px;
        color: white;
        border-radius: 3px;
        padding: 0 5px;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        z-index: 10;
        cursor: pointer;
        transition: transform 0.1s, z-index 0.1s;
    }

    .timeline-event:hover {
        z-index: 20;
        transform: scale(1.02);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }
</style>
{% endblock %}

{% block content %}
<div class="calendar-controls">
    <div>
        <a href="{{ url_for('global_calendar', week_offset=week_offset-1) }}" class="btn btn-sm btn-secondary">&lt;
            Anterior</a>
        <span style="font-size: 1.2em; font-weight: bold; margin: 0 15px;">
            Semana {{ start_date.strftime('%d/%m') }} - {{ end_date.strftime('%d/%m/%Y') }}
        </span>
        <a href="{{ url_for('global_calendar', week_offset=week_offset+1) }}" class="btn btn-sm btn-secondary">Siguiente
            &gt;</a>
    </div>
</div>

<!-- VIEW: ACTIVITY VERTICAL -->
<div id="activity-view" class="view-container">
    <table class="activity-view-table">
        <thead>
            <tr>
                <th style="width: 150px;">Actividad</th>
                {% for day in days %}
                <th>{{ day_names[loop.index0] }}<br><small>{{ day.strftime('%d/%m') }}</small></th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for activity_type, activity_data in events_by_activity.items() %}
            <tr>
                <td class="activity-row-header">{{ activity_type }}</td>
                {% for day in days %}
                {% set date_str = day.strftime('%Y-%m-%d') %}
                {% set cell_h = cell_heights.get(activity_type, {}).get(date_str, 50) %}
                <td class="activity-cell" style="height: {{ cell_h }}px;">
                    {% if activity_data[date_str] %}
                    {% for event in activity_data[date_str] %}
                    <div class="timeline-event" title="{{ event.pediatrician }} ({{ event.time_str }})"
                        style="left: {{ event.left }}%; width: {{ event.width }}%; top: {{ event.top }}px; background-color: {{ event.color }};">
                        {{ event.pediatrician }}
                    </div>
                    {% endfor %}
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}